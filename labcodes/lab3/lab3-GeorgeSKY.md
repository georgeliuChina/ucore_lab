#lab3实验报告
刘相
P14206021


- - -
- - -
## [练习0] 填写已有实验

> 已完成

[练习1.1] 请描述页目录项（Pag Director Entry）和页表（Page Table Entry）中组成部分对ucore实现页替换算法的潜在用处。


>可以看到
	#define PTE_PWT         0x008                   // Write-Through
    #define PTE_PCD         0x010                   // Cache-Disable
    #define PTE_A           0x020                   // Accessed
    #define PTE_D           0x040                   // Dirty
>这些关键字为实现页替换算法提供了良好的铺垫，其中Cache-Disable模块更为建立磁盘与内存之间的页读写缓存提供了可能。而Dirty和Write-Through也为在实线页替换算法是采取不同的写策略提供了可能（写直达和写回绕）
 用处是定位页面，过滤掉非法访问的页面。
[练习1.2] 如果ucore的缺页服务例程在执行过程中访问内存，出现了页访问异常，请问硬件要做哪些事情？
>答：
>在do_pgfault中，利用错误码和异常地址对异常进行处理，具体处理方法较为冗长，不详细列出。大致思路如下：
>1.	如果程序访问了非法地址，那么无法处理异常，将对应进程杀死。
>2.	如果进程的确拥有访问权限，先检查pte是否已存在，若不存在，分配pte,然后那么分为两种情况：
>	1.	没有分配过对应的物理页，那么为页分配实际的物理地址。
>	2.	如果需要调度的页的信息在disk的swap分区上，那么将其置换到真实内存中，并复制数据，完成处理。

- - -
[练习2.1] 如果要在ucore上实现"extended clock页替换算法"请给你的设计方案，现有的swap_manager框架是否足以支持在ucore中实现此算法？如果是，请给你的设计方案。如果不是，请给出你的新的扩展和基此扩展的设计方案。并需要回答如下问题

- 需要被换出的页的特征是什么？
- 在ucore中如何判断具有这样特征的页？
- 何时进行换入和换出操作？

> 否。现在的框架只有`map_swappable`、`set_unswappable`、`swap_out_victim`三个函数，没有对应于页面访问时触发的函数，因此页面替换算法无法得知页面是否倍访问过。扩展方案：加入一个意为`设置页面被访问`（名似`map_modified`）的函数，约定当页面被访问时调用。

> - 修改位和访问位都是0，而且是“时钟指针”扫过的第一块这样的页。
> - 修改位可以利用页面的`PTE_D`标记。访问位和“时钟指针”由页面置换算法自行记录，其中访问位利用我往框架里加入的那个函数。
> - 页缺失时换入并换出。


**需要被换出的页的特征是什么?**
>每次缺页查询时首个标记位（自从上次缺页以来是否被访问过）为0的页。

**在ucore中如何判断具有这样特征的页?**
>为pte和pde增加一个是否被访问过的标记位，在每次调用该页的时候将标记位设为1，每次缺页查询到该页的时候清除标记位。每次缺页查询时首个标记位为0的页应该被换出。

**何时进行换入和换出操作?**
>在发生缺页的同时系统分配的页面数已经饱和时，进行换入换出操作。
